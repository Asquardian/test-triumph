(()=>{"use strict";var t={56:(t,e,s)=>{t.exports=function(t){var e=s.nc;e&&t.setAttribute("nonce",e)}},72:t=>{var e=[];function s(t){for(var s=-1,o=0;o<e.length;o++)if(e[o].identifier===t){s=o;break}return s}function o(t,o){for(var r={},i=[],a=0;a<t.length;a++){var l=t[a],c=o.base?l[0]+o.base:l[0],h=r[c]||0,d="".concat(c," ").concat(h);r[c]=h+1;var p=s(d),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)e[p].references++,e[p].updater(u);else{var f=n(u,o);o.byIndex=a,e.splice(a,0,{identifier:d,updater:f,references:1})}i.push(d)}return i}function n(t,e){var s=e.domAPI(e);return s.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;s.update(t=e)}else s.remove()}}t.exports=function(t,n){var r=o(t=t||[],n=n||{});return function(t){t=t||[];for(var i=0;i<r.length;i++){var a=s(r[i]);e[a].references--}for(var l=o(t,n),c=0;c<r.length;c++){var h=s(r[c]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}r=l}}},100:(t,e,s)=>{s.d(e,{A:()=>a});var o=s(601),n=s.n(o),r=s(314),i=s.n(r)()(n());i.push([t.id,"work-area{width:3000px;height:1000px;display:block;overflow:hidden;transform:scale(var(--zoom)) translate(var(--translateX), var(--translateY));background-image:linear-gradient(to right, #a6a6a6 1px, transparent 1px),linear-gradient(to bottom, #a6a6a6 1px, transparent 1px);background-size:var(--cell) var(--cell);transform-origin:0 0;will-change:transform}work-area .x-labels,work-area .y-labels{top:0;position:absolute}work-area .x-labels div,work-area .y-labels div{color:#a6a6a6;width:var(--cell);height:14px;position:absolute;font-size:12px;z-index:100}work-area .x-labels{width:100%;height:14px;pointer-events:none}work-area .x-labels div{left:var(--offset)}work-area .y-labels{pointer-events:none;height:100%;width:14px}work-area .y-labels div{top:var(--offset)}work-area svg-polygon{position:absolute;left:var(--x);top:var(--y);user-select:none}html,body{padding:0;margin:0}.work-area__container{width:100%;height:1000px;overflow:hidden;background-color:#333}.buffer__control{width:100%;display:flex;gap:10px}.buffer__control button{display:flex;padding:8px 18px;background-color:#636363;border:none;border-radius:4px;color:#fff;outline:none;cursor:pointer}.buffer__control button:hover{background-color:#494949}.buffer__container{padding:20px;background-color:rgba(0,0,0,.32)}",""]);const a=i},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var s="",o=void 0!==e[5];return e[4]&&(s+="@supports (".concat(e[4],") {")),e[2]&&(s+="@media ".concat(e[2]," {")),o&&(s+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),s+=t(e),o&&(s+="}"),e[2]&&(s+="}"),e[4]&&(s+="}"),s}).join("")},e.i=function(t,s,o,n,r){"string"==typeof t&&(t=[[null,t,void 0]]);var i={};if(o)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(i[l]=!0)}for(var c=0;c<t.length;c++){var h=[].concat(t[c]);o&&i[h[0]]||(void 0!==r&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=r),s&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=s):h[2]=s),n&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=n):h[4]="".concat(n)),e.push(h))}},e}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var e={};t.exports=function(t,s){var o=function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}e[t]=s}return e[t]}(t);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(s)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(s){!function(t,e,s){var o="";s.supports&&(o+="@supports (".concat(s.supports,") {")),s.media&&(o+="@media ".concat(s.media," {"));var n=void 0!==s.layer;n&&(o+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),o+=s.css,n&&(o+="}"),s.media&&(o+="}"),s.supports&&(o+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(o,t,e.options)}(e,t,s)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function s(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={id:o,exports:{}};return t[o](r,r.exports,s),r.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.nc=void 0;var o=s(72),n=s.n(o),r=s(825),i=s.n(r),a=s(659),l=s.n(a),c=s(56),h=s.n(c),d=s(540),p=s.n(d),u=s(113),f=s.n(u),g=s(100),m={};m.styleTagTransform=f(),m.setAttributes=h(),m.insert=l().bind(null,"head"),m.domAPI=i(),m.insertStyleElement=p(),n()(g.A,m),g.A&&g.A.locals&&g.A.locals;class y extends HTMLElement{constructor(){if(super(),this.shadow=this.attachShadow({mode:"open"}),this._offsetX=0,this._offsetY=0,this._isDragging=!1,this._position={x:0,y:0},this.style.zIndex="1",this.setAttribute("draggable","true"),this.hasAttribute("points"))this.points=JSON.parse(this.getAttribute("points"));else{const t=Math.floor(5*Math.random())+3;this.points=this.generateSmoothPolygon(t),this.setAttribute("points",JSON.stringify(this.points))}this.addEventListener("serialize",this.serialize)}static get observedAttributes(){return["points"]}initMove(){this.addEventListener("dragstart",this.startDragging),this.addEventListener("dragend",this.endDragging),this.addEventListener("dragover",this.moveElement)}serialize(t){t.detail.polygons.push({position:this.position,points:this.points})}startDragging(t){t.dataTransfer.setData("application/x-svg-polygon-work","true");const e=new Image;t.dataTransfer.setDragImage(e,0,0),this.isDragging=!0,[this.offsetX,this.offsetY]=this.getOffset(t.clientX,t.clientY)}endDragging(){this.isDragging=!1}getOffset(t,e){const s=this.getBoundingClientRect(),o=this.parentElement.getBoundingClientRect(),n=o.width/this.parentElement.offsetWidth,r=o.height/this.parentElement.offsetHeight;return[(t-s.left)/n,(e-s.top)/r]}moveElement(t){t.dataTransfer.types.includes("application/x-svg-polygon-work")&&(this.position=this.setPositionElement(t.clientX,t.clientY,this.parentElement),this.style.setProperty("--x",`${this.position.x}px`),this.style.setProperty("--y",`${this.position.y}px`))}setPositionElement(t,e,s){const o=s.getBoundingClientRect(),n=o.width/s.offsetWidth,r=o.height/s.offsetHeight,i={x:(t-o.left-this.offsetX*n)/n,y:(e-o.top-this.offsetY*r)/r};return i.x<-30&&(i.x=-30),i.y<-30&&(i.y=-30),i.y>s.offsetHeight-180&&(i.y=s.offsetHeight-180),i.x>s.offsetWidth-180&&(i.x=s.offsetWidth-180),i}attributeChangedCallback(t,e,s){"points"===t&&s&&(this.points=JSON.parse(s),this.render())}connectedCallback(){this.position.x=this.style.getPropertyValue("--x").replace("px",""),this.position.y=this.style.getPropertyValue("--y").replace("px",""),this.closest("work-area")?this.initMove():(this.addEventListener("dragend",this.onDrag),this.addEventListener("dragstart",this.onDragStart)),this.render()}onDragStart(t){[this.offsetX,this.offsetY]=this.getOffset(t.clientX,t.clientY)}onDrag(t){const e=document.elementsFromPoint(t.clientX,t.clientY).find(t=>"work-area"===t.tagName.toLowerCase());if(e){const s=new y;console.log(t),s.cloneProps(this.points,this.offsetX,this.offsetY,t.clientX,t.clientY,e),e.append(s)}}cloneProps(t,e,s,o,n,r){this.points=t,this.offsetX=e,this.offsetY=s,this.position=this.setPositionElement(o,n,r),this.style.setProperty("--x",`${this.position.x}px`),this.style.setProperty("--y",`${this.position.y}px`)}generateSmoothPolygon(t,e=30){const s=e/2,o=e/2,n=e/2*.8,r=Array.from({length:t},(e,r)=>{const i=2*r*Math.PI/t;return{x:s+n*Math.cos(i),y:o+n*Math.sin(i)}}),i=[];for(let t=0;t<r.length;t++){const e=(t+1)%r.length;i.push(r[t]),i.push({x:(r[t].x+r[e].x)/2+5*(Math.random()-.5),y:(r[t].y+r[e].y)/2+5*(Math.random()-.5)})}return i}set isDragging(t){this._isDragging=t,this.style.zIndex=t?"10":"1"}set offsetX(t){this._offsetX=t}set offsetY(t){this._offsetY=t}get offsetX(){return this._offsetX}set position(t){this._position=t}get position(){return this._position}get offsetY(){return this._offsetY}render(){this.shadow.innerHTML="";const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","200"),t.setAttribute("height","200"),t.setAttribute("viewBox","0 0 30 30");const e=document.createElementNS("http://www.w3.org/2000/svg","polygon");e.setAttribute("points",this.points.map(t=>`${t.x},${t.y}`).join(" ")),e.setAttribute("fill","#940025"),t.appendChild(e),this.shadow.appendChild(t);const s=document.createElement("style");s.textContent="\n            :host {\n                display: inline-block;\n            }\n        ",this.shadow.appendChild(s)}}class v extends HTMLElement{constructor(){super(),this._zoom=1,this._minZoom=.8,this._maxZoom=2,this._isMove=!1,this._startDragPos={x:0,y:0},this._translate={x:0,y:0},this.cellOptions=new Map([[.8,"150px"],[1,"50px"],[1.5,"35px"],[2,"20px"]]),this.style.setProperty("--cell",this.getBreakpoint(this.zoom)),this.style.setProperty("--zoom",this.zoom),this.style.setProperty("--translateX",this.translate.x),this.style.setProperty("--translateY",this.translate.y),this.setEvents()}setEvents(){this.addEventListener("wheel",this.scaleGrid),this.addEventListener("mousedown",this.startTranslateGrid),this.addEventListener("mouseup",this.endTranslateGrid),this.addEventListener("mouseleave",this.endTranslateGrid),this.addEventListener("mousemove",this.translateGrid)}startTranslateGrid(t){t.target===this&&0===t.button&&(t.preventDefault(),this._startDragPos={x:t.clientX-this._translate.x,y:t.clientY-this._translate.y},this.isMove=!0)}restoreSavedValues(){const t=JSON.parse(localStorage.getItem("polygons"));t&&t.map(t=>{const e=new y;e.style.setProperty("--x",t.position.x+"px"),e.style.setProperty("--y",t.position.y+"px"),e.setAttribute("points",JSON.stringify(t.points)),this.appendChild(e)})}async connectedCallback(){try{this.restoreSavedValues()}catch(t){console.error(`Couldn't read saved work area: ${t.message}`)}this.render()}endTranslateGrid(t){this.isMove&&(this.isMove=!1)}translateGrid(t){this.isMove&&(this.translate={x:t.clientX-this._startDragPos.x,y:t.clientY-this._startDragPos.y})}scaleGrid(t){if(t.preventDefault(),this.isMove&&this.parentElement&&this.parentElement.classList.contains("work-area__container"))return void(this.parentElement.scrollLeft+=t.wheelDelta>0?30:-30);const e=t.deltaY<0?.1:-.1,s=this.zoom,o=Math.max(this._minZoom,Math.min(this._maxZoom,s+e));if(o===s)return;const n=this.getBoundingClientRect(),r=t.clientX-n.left,i=t.clientY-n.top,a=(r-this._translate.x)/s,l=(i-this._translate.y)/s;this.zoom=o,this.translate={x:.8*(r-a*o),y:.8*(i-l*o)},this.createLabels()}getBreakpoint(t){let e=this.cellOptions[0];for(const[s,o]of this.cellOptions){if(!(t>=s))break;e=o}return e}createNumbers(t,e,s){for(let o=1;o<e;o++){const e=document.createElement("div");e.style.setProperty("--offset",o*s+"px"),e.textContent=(o*s/10).toString(),t.append(e)}}createLabels(){const t=Number(this.getBreakpoint(this.zoom).replace("px",""));if(document.querySelectorAll(".x-labels, .y-labels").forEach(t=>t.remove()),t<0||isNaN(t))return void console.error("Error: breakpoint must be positive number");const e=document.createElement("div");e.classList.add("x-labels");const s=this.offsetWidth/Number(t);this.createNumbers(e,s,t),this.append(e);const o=document.createElement("div");o.classList.add("y-labels");const n=this.offsetWidth/Number(t);this.createNumbers(o,n,t),this.append(o)}render(){this.createLabels()}get zoom(){return this._zoom}set zoom(t){this._zoom=Math.max(this._minZoom,Math.min(this._maxZoom,t));const e=this.getBreakpoint(this._zoom);this.style.setProperty("--zoom",this._zoom.toString()),this.style.setProperty("--cell",e)}set translate(t){this._translate={x:t.x,y:t.y},this.style.setProperty("--translateX",`${this._translate.x}px`),this.style.setProperty("--translateY",`${this._translate.y}px`)}get translate(){return this._translate}get isMove(){return this._isMove}set isMove(t){this.style.cursor=t?"move":"",this._isMove=t}}window.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".js-input");t&&t.addEventListener("change",t=>{const e=Number(t.target.value);isNaN(e)?t.target.value=10:e>20?t.target.value=20:e<5&&(t.target.value=5)});const e=document.querySelector(".js-save");e&&e.addEventListener("click",()=>{const t=new CustomEvent("serialize",{bubbles:!1,composed:!0,cancelable:!0,detail:{polygons:[]}});document.querySelectorAll("work-area svg-polygon").forEach(e=>e.dispatchEvent(t)),t.detail.polygons.length>0&&localStorage.setItem("polygons",JSON.stringify(t.detail.polygons))});const s=document.querySelector(".js-clear");s&&s.addEventListener("click",()=>{localStorage.removeItem("polygons"),document.querySelectorAll("work-area svg-polygon").forEach(t=>t.remove()),o()});const o=()=>{const e=document.querySelector(".js-buffer-elements");if(!e)return;const s=t?t.value:4;e.innerHTML="";for(let t=0;t<s;t++){const t=new y;e.appendChild(t)}},n=document.querySelector(".js-create");n&&n.addEventListener("click",()=>{o()}),customElements.define("svg-polygon",y),customElements.define("work-area",v)})})();